<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile Setup</title>
    <link href="/css/profile-style.css" rel="stylesheet" />
</head>
<body>
    <!-- -----header starts---------- -->
    <header class="site-header">
        <div class="container-head">
            <a class="brand" href="/">
                    <svg class="logo" viewbox="0 0 24 24" aria-hidden="true"></svg>
                    <span>PL.</span>
            </a>
    
            <nav class="navbar" id="navbar">
                <a class="navbar-link" href="/">HOME</a>
                <a class="navbar-link" href="/dashboard">FIND TRAINERS</a>
                <a class="navbar-link" href="/profile">PROFILE</a>
                <a class="navbar-link" href="/logout">LOGOUT</a> 
            </nav>
        </div>
    </header>
    <!-- ======= header ends=========== -->

    <!-- ==============main starts here=========== -->
     <main>
        <section class="Profile">
        <div class="section-container">
                <div class="text-up"><h1>COMPLETE YOUR PROFILE</h1></div>

            <div class="add-picture">
                <h1>Add a profile picture</h1>
                <div class="file-container" id="customButton">
                    <img id="previewImage" src="<%= existingUser ? existingUser.profile_picture : '/img/avatar.jpeg' %>" alt="Profile Picture" style="max-width: 100%; height: 100%;"/>
                </div>
            </div>

            <div class="profile-form">
                <form action="/profile" method="post" enctype="multipart/form-data">
                    <div class="input-box">
                        <label for="profile_pic">Profile picture:</label>
                        <input type="file" name="profile_pic" class="file" id="fileInput" accept="image/*">
                    </div>
                    <div class="input-box">
                        <label for="firstname">First Name:</label>
                        <input type="text" name="first_name" placeholder="e.g: Ibraheem" value="<%= existingUser ? existingUser.firstname : '' %>" required>
                    </div>

                    <div class="input-box">
                        <label for=" lastname">Last Name:</label>
                        <input type="text" name="last_name" placeholder="e.g: Idowu" value="<%= existingUser ? existingUser.lastname : '' %>" required>
                    </div>

                    <div class="input-box">
                        <label for="Skills">Skills:</label>
                        <input type="text" name="skills" placeholder="e.g: Python,JavaScript,HTML" value="<%= skills || '' %>" required>
                    </div>

                    <div class="input-box">
                        <label for="Age" aria-required="true">Age:</label>
                        <input type="number" name="age" min="16" placeholder="e.g: 18" value="<%= existingUser ? existingUser.age : '' %>" required>
                    </div>

                    <div class="input-box">
                        <label for="Whatsapp">Whatsapp:</label>
                        <input type="number" name="whatsapp" value="<%= existingUser ? existingUser.whatsapp : '' %>" placeholder="eg: 08103798511" required>
                    </div>

                    <div class="input-box">
                        <input type="submit" value="Submit">
                        <% if (isTrainer) { %>
                            <a class="navbar-link" href="/trainer/<%= existingUser.id %>">YOU'RE ALREADY A TRAINER</a>
                        <% } else { %>
                            <a class="navbar-link" href="/trainer/apply">APPLY AS A TRAINER</a>
                        <% } %>
                    </div>
                </form>
            </div>
        </div>
        </section>

    <footer>
        <div class="main-ft">PL.</div>
        <div class="left1"><p>&copy; 2025 PL, Inc.</p></div>
        <div class="middle"><p>Terms of Service</p></div>
        <div class="right-ft"><p>Privacy Policy</p></div>
        
    </footer>
     </main>
     <!-- ============main ends here============ -->


       <!-- ==============script for input file========= -->
    <script>

        const fileInput = document.getElementById("fileInput");
        const previewImage = document.getElementById("previewImage");

        fileInput.addEventListener("change", () => {
            const file = fileInput.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                previewImage.src = e.target.result; // Update preview with selected image
                };
                reader.readAsDataURL(file);
            }
        })

        const firstNameInput = document.querySelector('input[name="first_name"]');
        const lastNameInput = document.querySelector('input[name="last_name"]');
        const skillsInput = document.querySelector('input[name="skills"]');
        const ageInput = document.querySelector('input[name="age"]');
        const whatsappInput = document.querySelector('input[name="whatsapp"]');

        [firstNameInput, lastNameInput].forEach(input => {
            input.addEventListener("input", () => {
                input.value = input.value.charAt(0).toUpperCase() + input.value.slice(1).toLowerCase().trim();
            })
        })

        skillsInput.addEventListener('input', () => {
            skillsInput.value = skillsInput.value.trim();
        })

        document.querySelector("form").addEventListener("submit", function(e) {
            const firstName = firstNameInput.value;
            const lastName = lastNameInput.value;
            let skills = skillsInput.value;
            const age = ageInput.value.trim();
            const whatsapp = whatsappInput.value.trim();

            // Regex patterns
            const nameRegex = /^[A-Z][a-zA-Z]*$/; // starts with capital, rest letters only
            const whatsappRegex = /^0\d{10}$/; // starts with 0, exactly 11 digits
            const skillsRegex = /^[A-Za-z]+(,[A-Za-z]+)*$/; // only letters separated by commas, no spaces

            // Validation checks
            if (!nameRegex.test(firstName)) {
                e.preventDefault();
                alert("First name must start with a capital letter and contain only letters (no spaces).");
                return;
            }

            if (!nameRegex.test(lastName)) {
                e.preventDefault();
                alert("Last name must start with a capital letter and contain only letters (no spaces).");
                return;
            }

            if (!/^[A-Za-z]+(,[A-Za-z]+)*$/.test(skills)) {
                e.preventDefault();
                alert("Skills must be a comma-separated list without trailing commas, spaces or any other special characters. Example: Python,JavaScript,HTML");
                return;
            }

            if (isNaN(age) || parseInt(age) < 16) {
                e.preventDefault();
                alert("Age must be a number and at least 16.");
                return;
            }

            if (!whatsappRegex.test(whatsapp)) {
                e.preventDefault();
                alert("WhatsApp number must be an 11-digit number starting with 0 (e.g. 08103798511).");
                return;
            }

            // Remove trailing commas before validating
            skills = skills.replace(/,+$/, "");

            if (!skillsRegex.test(skills)) {
                e.preventDefault();
                alert("Skills must be comma-separated words with no spaces. Example: Python,JavaScript,HTML");
                return;
            }

            // Update the input value with cleaned string (no trailing commas)
            skillsInput.value = skills;
        })
    </script>
</body>
</html>